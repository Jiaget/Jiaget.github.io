---
title: kafka
date: 2021-05-30 20:10:09
tags: 
    - 分布式
    - 消息系统
    - 中间件
categories: 消息队列
---
# 什么是kafks

kafka是一个分布式日志系统（也可以当作MQ系统）。

常用于：（日志收集系统，消息系统）
- web/nginx日志
- 访问日志
- 消息服务

它具备的属性：
- 分布式
- 分区
- 多副本
- 多订阅者

它设计目标是：
- 高效率：
    - 以时间复杂度为O(1)的方式提供消息持久化的能力， 即使TB级别的数据也能保证常数时间复杂度的访问性能。
- 高吞吐：
    - 在廉价的商用机器上也能保证100k条/s的消息传输。
- 分布式：
    - 支持Kafka Server 之间的消息分区，分布式消费。同时保证每个partition内消息顺序传输
- 同时支持离线数据处理和实时数据处理
- Scale out: 支持在线的水平拓展

## 所谓消息系统

消息系统负责将数据从一个应用传递到另外一个应用。应用不需要关心消息的传递方式，只需要关心消息的生产与消费。

分布式消息传递，基于可靠的消息队列，在客户端和消息系统之间异步传递消息。主流的消息传递模式有：
- 点对点
- 发布-订阅 （观察者模式）

Kafka使用的是后者。

### 点对点
所谓点对点传递，即在一个消息队列中，每条消息只能被消费一次，虽然一个消息队列有多个生产者和消费者在使用。这能保证数据的顺序。

tip：生产者发送一条消息，只有一个消费者能够收到。

### 发布-订阅
在这个模式中，消息不再存放在队列中，而是一个 `Topic`。且消费者可以订阅多个topic，且消费者可以消费订阅的topic中的数据。并且一条数据被一个消费者消费后并不会被马上删除，而还能被另外的消费者消费。

在这个模式下，生产者被叫做发布者，消费者被叫做订阅者。

tip：发布者发送消息到topic，所有且只有订阅了该topic的订阅者都会收到消息。

# Kafka的优点
- 解耦 / 扩展
    - 消息系统在处理过程中插入了一个接口层。发布者和订阅者都需要实现这个接口。这就意味着，双方都可以扩展或修改处理过程代码。方便未来需求的增加与修改。
- 副本
    - 将消息从队列中删除之前，需要保证消息已经处理完成。这是为了避免处理数据失败后，数据已经被删除导致的数据丢失引起的业务失败。
- 灵活 / 峰值处理能力
    - 保证访问量剧增的情况下，系统仍然正常运行。
- 恢复
    - 系统的一部分失效后，整个系统仍然正常运行。
- 有序
- 缓冲
    - 当一个系统中有需要处理的时间不同的消息。系统通过缓冲层保证消息以最高效率执行。
- 异步通信
    - 允许消息放入队列，而不立即处理，等需要时再去处理。

# Kafka的劣势
- 对于整个系统来说，对Kafka的依赖过高，一旦Kafka宕机，整个系统也崩溃了。所以需要保证其高可用
- 提高了系统复杂度。从系统间同步远程调用，到现在的异步调用，需要保证消息不丢失。
