---
title: 虚拟内存地址空间
date: 2021-06-03 12:30:37
tags:
    - 内存
    - golang
    - 操作系统
    - 汇编
categories: 内存
---

# 虚拟内存地址空间的分布
![Virtual-memory-address-space.png](https://i.loli.net/2021/06/03/geWDOKmTUXCZI31.png)

我们可以对内存空间进行如下分区管理：
## 代码段
 一段程序经过编译器编译成机器指令存储在可执行文件里，程序运行时，程序中的各个函数会被加载存放在虚拟地址空间中的代码段。

 代码段中指令的执行流程：
    - 顺序指令：每个进程只会执行一次
    - 循环指令：需要使用跳转指令返回函数的头部
    - 递归指令：需要借助栈来实现

代码段指令由 `操作码：操作对象` 构成。
- 操作码通常包括 `MOV`， `PUSH`，`POP`,`XCHG`
- 操作对象可以是
    - 立即数： 比如golang中某一段程序 `x := 1 + 1`， 其中的1就是立即数，它不会被储存在任意寄存器中，它直接包含在代码里。
    - 局部数据：也就是局部变量，它将在栈区分配空间，代码段会引用该数据地址
    - BSS数据与数据段数据：与上同，关于BSS，数据段将在下面详细说明。

## 数据段

数据段一般存放`已初始化`且`初值不为0`的全局变量和静态局部变量。数据段属于静态内存分配。

## BSS 段
有些地方可能会和数据段合并，将数据段划分为初始化区和未初始化区。

未初始化或者初值为0的全局变量和静态局部变量

## 堆
动态分配的内存。

在go中，我们使用 `make`, `new`来分配的就在堆中开辟。这部分的内存可以最终由 GC回收。
## 栈
局部变量，函数参数，返回地址等等